---
interface Props {
  keywords: { keyword: string; count: number }[];
  selectedKeywords: string[];
  getKeywordToggleUrl: (keyword: string) => string;
}

const { keywords, selectedKeywords, getKeywordToggleUrl } = Astro.props;

const TOP_N = 10;
const topKeywords = keywords.slice(0, TOP_N);
const remainingKeywords = keywords.slice(TOP_N);
const hasMore = remainingKeywords.length > 0;
---

<div class="mb-6">
  <div>
    <div class="flex items-center justify-between mb-2">
      <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300">
        Filter by Keyword
      </h3>
      {selectedKeywords.length > 0 && (
        <span class="text-xs text-gray-500 dark:text-gray-400">
          {selectedKeywords.length} selected
        </span>
      )}
    </div>

    {/* Always show top 10 keywords */}
    <div class="flex flex-wrap gap-2 mb-2">
      {topKeywords.map(({ keyword, count }) => {
        const isSelected = selectedKeywords.includes(keyword);
        return (
          <a
            href={getKeywordToggleUrl(keyword)}
            class:list={[
              "badge gap-1.5",
              isSelected
                ? "badge-primary"
                : "badge-soft"
            ]}
          >
            {keyword}
            <span class="badge text-[10px]">
              {count}
            </span>
          </a>
        );
      })}
    </div>

    {/* Show more/less for remaining keywords */}
    {hasMore && (
      <details class="collapse mt-2">
        <summary class="collapse-title text-xs font-medium">
          Show more +
        </summary>
        <div class="collapse-content">
          <div class="flex flex-wrap gap-2">
            {remainingKeywords.map(({ keyword, count }) => {
              const isSelected = selectedKeywords.includes(keyword);
              return (
                <a
                  href={getKeywordToggleUrl(keyword)}
                  class:list={[
                    "badge gap-1.5",
                    isSelected
                      ? "badge-primary"
                      : "badge-soft"
                  ]}
                >
                  {keyword}
                  <span class="badge text-[10px]">
                    {count}
                  </span>
                </a>
              );
            })}
          </div>
        </div>
      </details>
    )}
  </div>
</div>
