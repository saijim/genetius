---
interface Props {
  keywords: { keyword: string; count: number }[];
  selectedKeywords: string[];
  getKeywordToggleUrl: (keyword: string) => string;
}

const { keywords, selectedKeywords, getKeywordToggleUrl } = Astro.props;

const TOP_N = 10;
const topKeywords = keywords.slice(0, TOP_N);
const remainingKeywords = keywords.slice(TOP_N);
const hasMore = remainingKeywords.length > 0;

const isKeywordSelected = (keyword: string): boolean => selectedKeywords.includes(keyword);
---

<div class="mb-6">
  <div>
    <div class="flex items-center justify-between mb-2">
      <h3 class="text-sm font-semibold text-gray-300">
        Filter by Keyword
      </h3>
      {selectedKeywords.length > 0 && (
        <span class="text-xs text-gray-400">
          {selectedKeywords.length} selected
        </span>
      )}
    </div>

    {/* Always show top 10 keywords */}
    <div class="flex flex-wrap gap-2 mb-2">
      {topKeywords.map(({ keyword, count }) => (
          <a
            href={getKeywordToggleUrl(keyword)}
            class:list={[
              "badge gap-1.5",
              isKeywordSelected(keyword)
                ? "badge-primary"
                : "badge-soft"
            ]}
          >
            {keyword}
            <span class="badge text-[10px]">
              {count}
            </span>
          </a>
        ))}
    </div>
  </div>

  {/* Dropdown for remaining keywords */}
  {hasMore && (
    <div class="dropdown relative inline-flex [--offset:8] [--placement:bottom-start]">
      <button
        id="keyword-dropdown"
        type="button"
        class="dropdown-toggle btn btn-sm btn-soft btn-primary"
        aria-haspopup="menu"
        aria-expanded="false"
        aria-label="Show more keywords"
      >
        Show more +
        <span class="icon-[tabler--chevron-down] dropdown-open:rotate-180 size-4"></span>
      </button>
      <div
        class="dropdown-menu dropdown-open:opacity-100 hidden max-h-60 overflow-y-auto min-w-64"
        role="menu"
        aria-orientation="vertical"
        aria-labelledby="keyword-dropdown"
      >
        <div class="dropdown-header p-2 border-b border-base-content/20">
          <span class="text-sm font-semibold">All Keywords</span>
        </div>
          {remainingKeywords.map(({ keyword, count }) => (
              <a
                href={getKeywordToggleUrl(keyword)}
                class:list={[
                  "dropdown-item flex items-center justify-between gap-2",
                  isKeywordSelected(keyword)
                    ? "dropdown-active"
                    : ""
                ]}
              >
                <span>{keyword}</span>
                <span class="badge badge-soft text-[10px]">{count}</span>
              </a>
            ))}
      </div>
    </div>
  )}
</div>
