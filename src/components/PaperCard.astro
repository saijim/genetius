 ---
import type { PaperData } from '~/lib/markdown';

interface Props {
  paper: PaperData;
  getKeywordToggleUrl?: (keyword: string) => string;
}

const { paper, getKeywordToggleUrl } = Astro.props;

// Sanitize DOI for use in HTML IDs - replace special characters that are invalid in CSS selectors
const safeId = paper.doi.replace(/[^a-zA-Z0-9_-]/g, '_');
---
<article class="card bg-base-100 shadow-md">
  <div class="card-body">
    <h2 class="card-title">{paper.title}</h2>

    {paper.authors && paper.authors.length > 0 && (
      <p class="text-sm">
        <span class="font-medium">Authors:</span> {paper.authors.join(', ')}
      </p>
    )}

    <div class="text-sm text-base-content/70">
      <span class="font-medium">Date:</span> {paper.date} Â·{' '}
      <span class="font-medium">Version:</span> {paper.version}
    </div>

    <a
      href={`https://doi.org/${paper.doi}`}
      target="_blank"
      rel="noopener noreferrer"
      aria-label={`View full paper for DOI ${paper.doi}`}
      class="text-sm text-primary hover:underline block"
    >
      DOI: {paper.doi}
    </a>

    {paper.category && (
      <p class="text-sm text-base-content/70">
        <span class="font-medium">Category:</span> {paper.category}
      </p>
    )}

    {paper.modelOrganism && (
      <p class="text-sm text-base-content/70">
        <span class="font-medium">Model Organism:</span>{' '}
        <a
          href={`/?organism=${encodeURIComponent(paper.modelOrganism)}`}
          class="text-primary hover:underline"
        >
          {paper.modelOrganism}
        </a>
      </p>
    )}

    {paper.summary && (
      <div>
        <button
          type="button"
          class="collapse-toggle link link-primary text-lg font-semibold mb-1 flex items-center"
          id={`paper-summary-${safeId}`}
          data-collapse={`#paper-summary-content-${safeId}`}
          aria-expanded="false"
          aria-controls={`paper-summary-content-${safeId}`}
        >
          <span class="icon-[tabler--chevron-right] collapse-open:rotate-90 size-4"></span>
          AI Summary
        </button>
        <div
          id={`paper-summary-content-${safeId}`}
          class="collapse hidden w-full overflow-hidden transition-[height] duration-300"
          aria-labelledby={`paper-summary-${safeId}`}
        >
          <p class="text-base-content mt-2 leading-relaxed">
            {paper.summary}
          </p>
        </div>
      </div>
    )}

    {paper.keywords && paper.keywords.length > 0 && (
      <div class="card-actions flex flex-wrap gap-2">
        {paper.keywords.map((keyword) => (
          <a
            href={getKeywordToggleUrl ? getKeywordToggleUrl(keyword) : `/?keywords=${encodeURIComponent(keyword)}`}
            class="badge badge-primary hover:badge-primary/80 transition-opacity cursor-pointer"
          >
            {keyword}
          </a>
        ))}
      </div>
    )}
  </div>
</article>
