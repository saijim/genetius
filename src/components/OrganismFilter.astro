---
interface Props {
  organisms: { organism: string; count: number }[];
  selectedOrganism: string;
  getOrganismUrl: (organism: string) => string;
}

const { organisms, selectedOrganism, getOrganismUrl } = Astro.props;

---

<div class="mb-6">
  <div>
    <div class="flex items-center justify-between mb-2">
      <h3 class="text-sm font-semibold text-gray-300">
        Filter by Model Organism
      </h3>
      {selectedOrganism && (
        <span class="text-xs text-blue-400">
          1 selected
        </span>
      )}
    </div>

    {/* Dropdown for all organisms */}
    <div class="dropdown relative inline-flex [--offset:8] [--placement:bottom-start]">
      <button
        id="organism-dropdown"
        type="button"
        class="dropdown-toggle btn btn-sm btn-primary w-full"
        aria-haspopup="menu"
        aria-expanded="false"
        aria-label="Filter by organism"
      >
        <span class="icon-[tabler--filter] size-4"></span>
        <span class="flex-1 text-left">{selectedOrganism || 'Select Organism'}</span>
        <span class="icon-[tabler--chevron-down] dropdown-open:rotate-180 size-4"></span>
      </button>
      <div
        class="dropdown-menu dropdown-open:opacity-100 hidden max-h-80 overflow-y-auto min-w-64"
        role="menu"
        aria-orientation="vertical"
        aria-labelledby="organism-dropdown"
      >
        <div class="dropdown-header p-2 border-b border-base-content/20 flex items-center justify-between">
          <span class="text-sm font-semibold">All Organisms</span>
          {selectedOrganism && (
            <a
              href={getOrganismUrl('')}
              class="btn btn-xs btn-ghost btn-error"
              aria-label="Clear selection"
            >
              Clear
            </a>
          )}
        </div>
        {organisms.map(({ organism, count }) => {
          const isSelected = selectedOrganism === organism;
          return (
            <a
              href={getOrganismUrl(isSelected ? '' : organism)}
              class:list={[
                "dropdown-item flex items-center justify-between gap-2",
                isSelected
                  ? "dropdown-active"
                  : ""
              ]}
            >
              <span>{organism}</span>
              <span class="badge badge-soft text-[10px]">{count}</span>
            </a>
          );
        })}
      </div>
    </div>
  </div>
</div>
