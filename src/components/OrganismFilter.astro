---
interface Props {
  organisms: { organism: string; count: number }[];
  selectedOrganism: string;
  getOrganismUrl: (organism: string) => string;
}

const { organisms, selectedOrganism, getOrganismUrl } = Astro.props;

const TOP_N = 10;
const topOrganisms = organisms.slice(0, TOP_N);
const remainingOrganisms = organisms.slice(TOP_N);
const hasMore = remainingOrganisms.length > 0;
---

<div class="mb-6">
  <div>
    <div class="flex items-center justify-between mb-2">
      <h3 class="text-sm font-semibold text-gray-300">
        Filter by Model Organism
      </h3>
      {selectedOrganism && (
        <span class="text-xs text-blue-400">
          1 selected
        </span>
      )}
    </div>

    {/* Always show top 10 organisms */}
    <div class="flex flex-wrap gap-2 mb-2">
      {topOrganisms.map(({ organism, count }) => {
        const isSelected = selectedOrganism === organism;
        return (
          <a
            href={getOrganismUrl(isSelected ? '' : organism)}
            class:list={[
              "badge gap-1.5",
              isSelected
                ? "badge-primary"
                : "badge-soft"
            ]}
          >
            {organism}
            <span class="badge text-[10px]">
              {count}
            </span>
          </a>
        );
      })}

      {selectedOrganism && (
        <a
          href={getOrganismUrl('')}
          class="badge badge-error"
        >
          Clear
        </a>
      )}
    </div>

    {/* Dropdown for remaining organisms */}
    {hasMore && (
      <div class="dropdown relative inline-flex [--offset:8] [--placement:bottom-start]">
        <button
          id="organism-dropdown"
          type="button"
          class="dropdown-toggle btn btn-sm btn-soft btn-primary"
          aria-haspopup="menu"
          aria-expanded="false"
          aria-label="Show more organisms"
        >
          Show more +
          <span class="icon-[tabler--chevron-down] dropdown-open:rotate-180 size-4"></span>
        </button>
        <div
          class="dropdown-menu dropdown-open:opacity-100 hidden max-h-60 overflow-y-auto min-w-64"
          role="menu"
          aria-orientation="vertical"
          aria-labelledby="organism-dropdown"
        >
          <div class="dropdown-header p-2 border-b border-base-content/20">
            <span class="text-sm font-semibold">All Organisms</span>
          </div>
          {remainingOrganisms.map(({ organism, count }) => {
            const isSelected = selectedOrganism === organism;
            return (
              <a
                href={getOrganismUrl(isSelected ? '' : organism)}
                class="dropdown-item flex items-center justify-between gap-2"
              >
                <span>{organism}</span>
                <span class="badge badge-soft text-[10px]">{count}</span>
              </a>
            );
          })}
        </div>
      </div>
    )}
  </div>
</div>
