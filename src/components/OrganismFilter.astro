---
interface Props {
  organisms: { organism: string; count: number }[];
  selectedOrganism: string;
  getOrganismUrl: (organism: string) => string;
}

const { organisms, selectedOrganism, getOrganismUrl } = Astro.props;

const TOP_N = 10;
const topOrganisms = organisms.slice(0, TOP_N);
const remainingOrganisms = organisms.slice(TOP_N);
const hasMore = remainingOrganisms.length > 0;
---

<div class="mb-6">
  <div>
    <div class="flex items-center justify-between mb-2">
      <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300">
        Filter by Model Organism
      </h3>
      {selectedOrganism && (
        <span class="text-xs text-blue-600 dark:text-blue-400">
          1 selected
        </span>
      )}
    </div>

    {/* Always show top 10 organisms */}
    <div class="flex flex-wrap gap-2 mb-2">
      {topOrganisms.map(({ organism, count }) => {
        const isSelected = selectedOrganism === organism;
        return (
          <a
            href={getOrganismUrl(isSelected ? '' : organism)}
            class:list={[
              "inline-flex items-center px-3 py-1 rounded-full text-xs font-medium transition-colors border",
              isSelected
                ? "bg-green-100 text-green-800 border-green-200 dark:bg-green-900 dark:text-green-200 dark:border-green-800 hover:bg-green-200 dark:hover:bg-green-800"
                : "bg-gray-50 text-gray-600 border-gray-200 dark:bg-gray-800 dark:text-gray-300 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700 hover:border-gray-300 dark:hover:border-gray-600"
            ]}
          >
            {organism}
            <span class:list={[
              "ml-1.5 px-1.5 py-0.5 rounded-full text-[10px]",
              isSelected
                ? "bg-green-200 text-green-900 dark:bg-green-800 dark:text-green-100"
                : "bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-400"
            ]}>
              {count}
            </span>
          </a>
        );
      })}

      {selectedOrganism && (
        <a
          href={getOrganismUrl('')}
          class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium transition-colors border border-red-200 bg-red-50 text-red-700 hover:bg-red-100 dark:bg-red-900/20 dark:text-red-400 dark:border-red-800 dark:hover:bg-red-900/30"
        >
          Clear
        </a>
      )}
    </div>

    {/* Show more/less for remaining organisms */}
    {hasMore && (
      <details class="border border-gray-200 dark:border-gray-700 rounded-lg mt-2">
        <summary class="list-none cursor-pointer flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
          <span class="text-xs text-blue-600 dark:text-blue-400 font-medium">
            Show more +
          </span>
        </summary>
        <div class="p-3 pt-2 border-t border-gray-200 dark:border-gray-700">
          <div class="flex flex-wrap gap-2">
            {remainingOrganisms.map(({ organism, count }) => {
              const isSelected = selectedOrganism === organism;
              return (
                <a
                  href={getOrganismUrl(isSelected ? '' : organism)}
                  class:list={[
                    "inline-flex items-center px-3 py-1 rounded-full text-xs font-medium transition-colors border",
                    isSelected
                      ? "bg-green-100 text-green-800 border-green-200 dark:bg-green-900 dark:text-green-200 dark:border-green-800 hover:bg-green-200 dark:hover:bg-green-800"
                      : "bg-gray-50 text-gray-600 border-gray-200 dark:bg-gray-800 dark:text-gray-300 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700 hover:border-gray-300 dark:hover:border-gray-600"
                  ]}
                >
                  {organism}
                  <span class:list={[
                    "ml-1.5 px-1.5 py-0.5 rounded-full text-[10px]",
                    isSelected
                      ? "bg-green-200 text-green-900 dark:bg-green-800 dark:text-green-100"
                      : "bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-400"
                  ]}>
                    {count}
                  </span>
                </a>
              );
            })}
          </div>
        </div>
      </details>
    )}
  </div>
</div>
